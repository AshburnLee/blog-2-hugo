<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>1.7.agent VLM | Junhui&#39;s Journal 2</title>
<meta name="keywords" content="Agent, VLM, Smolagents">
<meta name="description" content="smolagents 对 vision-language models (VLMs) 提供了支持。
使得 Agent 能够有效地处理和解释图像。
在 Agent 执行开始时提供图像
实例：
from PIL import Image
import requests
from io import BytesIO

image_urls = [
    &#34;https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg&#34;, # Joker image
    &#34;https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg&#34; # Joker image
]

# 模型的输入
images = []
for url in image_urls:
    headers = {
        &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&#34; 
    }
    response = requests.get(url,headers=headers)
    image = Image.open(BytesIO(response.content)).convert(&#34;RGB&#34;)  # 只需RGB 信息
    images.append(image)

from smolagents import CodeAgent, OpenAIServerModel

# 使用哪个模型
model = OpenAIServerModel(model_id=&#34;gpt-4o&#34;)

# Instantiate the agent
agent = CodeAgent(
    tools=[],
    model=model,
    max_steps=20,
    verbosity_level=2
)

response = agent.run(
    &#34;&#34;&#34;
    Describe the costume and makeup that the comic character in these photos is wearing and return the description.
    Tell me if the guest is The Joker or Wonder Woman.
    &#34;&#34;&#34;,
    images=images  # 给出输入的图片
)
这个实例是使用模型描述输入 images">
<meta name="author" content="">
<link rel="canonical" href="https://ashburnLee.github.io/blog-2-hugo/agent/1.7.agent-vlm/">
<link crossorigin="anonymous" href="/blog-2-hugo/assets/css/stylesheet.bdaf5941cb3c05e36e857d9e2953ba0c4485ba7bc2da15db169d66a77cbc7a87.css" integrity="sha256-va9ZQcs8BeNuhX2eKVO6DESFunvC2hXbFp1mp3y8eoc=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ashburnLee.github.io/blog-2-hugo/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ashburnLee.github.io/blog-2-hugo/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ashburnLee.github.io/blog-2-hugo/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ashburnLee.github.io/blog-2-hugo/apple-touch-icon.png">
<link rel="mask-icon" href="https://ashburnLee.github.io/blog-2-hugo/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ashburnLee.github.io/blog-2-hugo/agent/1.7.agent-vlm/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" id="MathJax-script" async></script>


<meta property="og:url" content="https://ashburnLee.github.io/blog-2-hugo/agent/1.7.agent-vlm/">
  <meta property="og:site_name" content="Junhui&#39;s Journal 2">
  <meta property="og:title" content="1.7.agent VLM">
  <meta property="og:description" content="smolagents 对 vision-language models (VLMs) 提供了支持。
使得 Agent 能够有效地处理和解释图像。
在 Agent 执行开始时提供图像 实例：
from PIL import Image import requests from io import BytesIO image_urls = [ &#34;https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg&#34;, # Joker image &#34;https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg&#34; # Joker image ] # 模型的输入 images = [] for url in image_urls: headers = { &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&#34; } response = requests.get(url,headers=headers) image = Image.open(BytesIO(response.content)).convert(&#34;RGB&#34;) # 只需RGB 信息 images.append(image) from smolagents import CodeAgent, OpenAIServerModel # 使用哪个模型 model = OpenAIServerModel(model_id=&#34;gpt-4o&#34;) # Instantiate the agent agent = CodeAgent( tools=[], model=model, max_steps=20, verbosity_level=2 ) response = agent.run( &#34;&#34;&#34; Describe the costume and makeup that the comic character in these photos is wearing and return the description. Tell me if the guest is The Joker or Wonder Woman. &#34;&#34;&#34;, images=images # 给出输入的图片 ) 这个实例是使用模型描述输入 images">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="agent">
    <meta property="article:published_time" content="2025-08-31T12:13:27+08:00">
    <meta property="article:modified_time" content="2025-08-31T12:13:27+08:00">
    <meta property="article:tag" content="Agent">
    <meta property="article:tag" content="VLM">
    <meta property="article:tag" content="Smolagents">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="1.7.agent VLM">
<meta name="twitter:description" content="smolagents 对 vision-language models (VLMs) 提供了支持。
使得 Agent 能够有效地处理和解释图像。
在 Agent 执行开始时提供图像
实例：
from PIL import Image
import requests
from io import BytesIO

image_urls = [
    &#34;https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg&#34;, # Joker image
    &#34;https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg&#34; # Joker image
]

# 模型的输入
images = []
for url in image_urls:
    headers = {
        &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&#34; 
    }
    response = requests.get(url,headers=headers)
    image = Image.open(BytesIO(response.content)).convert(&#34;RGB&#34;)  # 只需RGB 信息
    images.append(image)

from smolagents import CodeAgent, OpenAIServerModel

# 使用哪个模型
model = OpenAIServerModel(model_id=&#34;gpt-4o&#34;)

# Instantiate the agent
agent = CodeAgent(
    tools=[],
    model=model,
    max_steps=20,
    verbosity_level=2
)

response = agent.run(
    &#34;&#34;&#34;
    Describe the costume and makeup that the comic character in these photos is wearing and return the description.
    Tell me if the guest is The Joker or Wonder Woman.
    &#34;&#34;&#34;,
    images=images  # 给出输入的图片
)
这个实例是使用模型描述输入 images">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Agent",
      "item": "https://ashburnLee.github.io/blog-2-hugo/agent/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "1.7.agent VLM",
      "item": "https://ashburnLee.github.io/blog-2-hugo/agent/1.7.agent-vlm/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "1.7.agent VLM",
  "name": "1.7.agent VLM",
  "description": "smolagents 对 vision-language models (VLMs) 提供了支持。\n使得 Agent 能够有效地处理和解释图像。\n在 Agent 执行开始时提供图像 实例：\nfrom PIL import Image import requests from io import BytesIO image_urls = [ \u0026#34;https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg\u0026#34;, # Joker image \u0026#34;https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg\u0026#34; # Joker image ] # 模型的输入 images = [] for url in image_urls: headers = { \u0026#34;User-Agent\u0026#34;: \u0026#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\u0026#34; } response = requests.get(url,headers=headers) image = Image.open(BytesIO(response.content)).convert(\u0026#34;RGB\u0026#34;) # 只需RGB 信息 images.append(image) from smolagents import CodeAgent, OpenAIServerModel # 使用哪个模型 model = OpenAIServerModel(model_id=\u0026#34;gpt-4o\u0026#34;) # Instantiate the agent agent = CodeAgent( tools=[], model=model, max_steps=20, verbosity_level=2 ) response = agent.run( \u0026#34;\u0026#34;\u0026#34; Describe the costume and makeup that the comic character in these photos is wearing and return the description. Tell me if the guest is The Joker or Wonder Woman. \u0026#34;\u0026#34;\u0026#34;, images=images # 给出输入的图片 ) 这个实例是使用模型描述输入 images\n",
  "keywords": [
    "Agent", "VLM", "Smolagents"
  ],
  "articleBody": "smolagents 对 vision-language models (VLMs) 提供了支持。\n使得 Agent 能够有效地处理和解释图像。\n在 Agent 执行开始时提供图像 实例：\nfrom PIL import Image import requests from io import BytesIO image_urls = [ \"https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg\", # Joker image \"https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg\" # Joker image ] # 模型的输入 images = [] for url in image_urls: headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36\" } response = requests.get(url,headers=headers) image = Image.open(BytesIO(response.content)).convert(\"RGB\") # 只需RGB 信息 images.append(image) from smolagents import CodeAgent, OpenAIServerModel # 使用哪个模型 model = OpenAIServerModel(model_id=\"gpt-4o\") # Instantiate the agent agent = CodeAgent( tools=[], model=model, max_steps=20, verbosity_level=2 ) response = agent.run( \"\"\" Describe the costume and makeup that the comic character in these photos is wearing and return the description. Tell me if the guest is The Joker or Wonder Woman. \"\"\", images=images # 给出输入的图片 ) 这个实例是使用模型描述输入 images\n提供动态检索的图像 当用户后头没有 images 时，需要从互联网或其他数据库中获取。在这种方法中，图像在执行过程中动态地添加到 Agent 的记忆中。回忆， multi-step agent 是一个 ReAct 框架的抽象：\n系统提示步骤：存储系统提示。 任务步骤：记录用户查询和提供的任何输入。 动作步骤：捕获代理操作的日志和结果。 上面是一个循环。在这个循环过程中，代理动态地整合视觉信息。并适应性地响应不断变化的任务。\n我们需要使用 Selenium 和 Helium，它们是浏览器自动化工具。同时 我们需要一套专门为浏览设计的代理工具，例如 search_item_ctrl_f 、 go_back 和 close_popups 。这些工具允许代理像人类一样浏览网络。\n@tool def search_item_ctrl_f(text: str, nth_result: int = 1) -\u003e str: \"\"\" Searches for text on the current page via Ctrl + F and jumps to the nth occurrence. Args: text: The text to search for nth_result: Which occurrence to jump to (default: 1) \"\"\" elements = driver.find_elements(By.XPATH, f\"//*[contains(text(), '{text}')]\") if nth_result \u003e len(elements): raise Exception(f\"Match n°{nth_result} not found (only {len(elements)} matches found)\") result = f\"Found {len(elements)} matches for '{text}'.\" elem = elements[nth_result - 1] driver.execute_script(\"arguments[0].scrollIntoView(true);\", elem) result += f\"Focused on element {nth_result} of {len(elements)}\" return result @tool def go_back() -\u003e None: \"\"\"Goes back to previous page.\"\"\" driver.back() @tool def close_popups() -\u003e str: \"\"\" Closes any visible modal or pop-up on the page. Use this to dismiss pop-up windows! This does not work on cookie consent banners. \"\"\" webdriver.ActionChains(driver).send_keys(Keys.ESCAPE).perform() 我们还需要保存屏幕截图的功能(Tool)，因为这将是我们 VLM 代理完成任务的关键部分。此功能捕获屏幕截图并将其保存到 step_log.observations_images = [image.copy()] 中，允许代理在导航过程中动态存储和处理图像。 ***\ndef save_screenshot(step_log: ActionStep, agent: CodeAgent) -\u003e None: sleep(1.0) # Let JavaScript animations happen before taking the screenshot driver = helium.get_driver() current_step = step_log.step_number if driver is not None: for step_logs in agent.logs: # Remove previous screenshots from logs for lean processing if isinstance(step_log, ActionStep) and step_log.step_number \u003c= current_step - 2: step_logs.observations_images = None png_bytes = driver.get_screenshot_as_png() image = Image.open(BytesIO(png_bytes)) print(f\"Captured a browser screenshot: {image.size} pixels\") step_log.observations_images = [image.copy()] # Create a copy to ensure it persists, important! # Update observations with current URL url_info = f\"Current url: {driver.current_url}\" step_log.observations = url_info if step_logs.observations is None else step_log.observations + \"\\n\" + url_info return 上面的该功能作为 step_callback 传递给代理【不是一个tool】，因为它在代理执行过程中的每个步骤结束时触发。这允许代理在其过程中动态捕获和保存屏幕截图：\nfrom smolagents import CodeAgent, OpenAIServerModel, DuckDuckGoSearchTool model = OpenAIServerModel(model_id=\"gpt-4o\") agent = CodeAgent( tools=[DuckDuckGoSearchTool(), go_back, close_popups, search_item_ctrl_f], model=model, additional_authorized_imports=[\"helium\"], step_callbacks=[save_screenshot], # 在这里 max_steps=20, verbosity_level=2, ) 如此，在用户就可以提需求了：\nagent.run(\"\"\" Please search for images of Wonder Woman and generate a detailed visual description based on those images. Additionally, navigate to Wikipedia to gather key details about her appearance. With this information, I can determine whether to grant her access to the event. \"\"\" + helium_instructions) YouTube 流程\n",
  "wordCount" : "473",
  "inLanguage": "en",
  "datePublished": "2025-08-31T12:13:27+08:00",
  "dateModified": "2025-08-31T12:13:27+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ashburnLee.github.io/blog-2-hugo/agent/1.7.agent-vlm/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Junhui's Journal 2",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ashburnLee.github.io/blog-2-hugo/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ashburnLee.github.io/blog-2-hugo/" accesskey="h" title="Junhui&#39;s Journal 2 (Alt + H)">Junhui&#39;s Journal 2</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ashburnLee.github.io/blog-2-hugo/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://ashburnLee.github.io/blog-2-hugo/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://ashburnLee.github.io/blog-2-hugo/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      1.7.agent VLM
    </h1>
    <div class="post-meta"><span title='2025-08-31 12:13:27 +0800 CST'>August 31, 2025</span>

</div>
  </header> 
  <div class="post-content"><p>smolagents 对 vision-language models (VLMs) 提供了支持。</p>
<p>使得 Agent 能够有效地处理和解释图像。</p>
<h2 id="在-agent-执行开始时提供图像">在 Agent 执行开始时提供图像<a hidden class="anchor" aria-hidden="true" href="#在-agent-执行开始时提供图像">#</a></h2>
<p>实例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> BytesIO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_urls <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://upload.wikimedia.org/wikipedia/commons/e/e8/The_Joker_at_Wax_Museum_Plus.jpg&#34;</span>, <span style="color:#75715e"># Joker image</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;https://upload.wikimedia.org/wikipedia/en/9/98/Joker_%28DC_Comics_character%29.jpg&#34;</span> <span style="color:#75715e"># Joker image</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 模型的输入</span>
</span></span><span style="display:flex;"><span>images <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> url <span style="color:#f92672">in</span> image_urls:
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;User-Agent&#34;</span>: <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&#34;</span> 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url,headers<span style="color:#f92672">=</span>headers)
</span></span><span style="display:flex;"><span>    image <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(BytesIO(response<span style="color:#f92672">.</span>content))<span style="color:#f92672">.</span>convert(<span style="color:#e6db74">&#34;RGB&#34;</span>)  <span style="color:#75715e"># 只需RGB 信息</span>
</span></span><span style="display:flex;"><span>    images<span style="color:#f92672">.</span>append(image)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> smolagents <span style="color:#f92672">import</span> CodeAgent, OpenAIServerModel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用哪个模型</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> OpenAIServerModel(model_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gpt-4o&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Instantiate the agent</span>
</span></span><span style="display:flex;"><span>agent <span style="color:#f92672">=</span> CodeAgent(
</span></span><span style="display:flex;"><span>    tools<span style="color:#f92672">=</span>[],
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>model,
</span></span><span style="display:flex;"><span>    max_steps<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,
</span></span><span style="display:flex;"><span>    verbosity_level<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>response <span style="color:#f92672">=</span> agent<span style="color:#f92672">.</span>run(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Describe the costume and makeup that the comic character in these photos is wearing and return the description.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Tell me if the guest is The Joker or Wonder Woman.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    images<span style="color:#f92672">=</span>images  <span style="color:#75715e"># 给出输入的图片</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>这个实例是使用模型描述输入 images</p>
<h2 id="提供动态检索的图像">提供动态检索的图像<a hidden class="anchor" aria-hidden="true" href="#提供动态检索的图像">#</a></h2>
<p>当用户后头没有 images 时，需要从互联网或其他数据库中获取。在这种方法中，图像在执行过程中动态地添加到 Agent 的记忆中。回忆， multi-step agent 是一个 ReAct 框架的抽象：</p>
<ol>
<li>系统提示步骤：存储系统提示。</li>
<li>任务步骤：记录用户查询和提供的任何输入。</li>
<li>动作步骤：捕获代理操作的日志和结果。</li>
</ol>
<p>上面是一个循环。在这个循环过程中，代理动态地整合视觉信息。并适应性地响应不断变化的任务。</p>
<p>我们需要使用 <code>Selenium</code> 和 <code>Helium</code>，它们是浏览器自动化工具。同时 我们需要一套专门为浏览设计的代理工具，例如 <code>search_item_ctrl_f</code> 、 <code>go_back</code> 和 <code>close_popups</code> 。这些工具允许代理像人类一样浏览网络。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#a6e22e">@tool</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search_item_ctrl_f</span>(text: str, nth_result: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Searches for text on the current page via Ctrl + F and jumps to the nth occurrence.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        text: The text to search for
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        nth_result: Which occurrence to jump to (default: 1)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    elements <span style="color:#f92672">=</span> driver<span style="color:#f92672">.</span>find_elements(By<span style="color:#f92672">.</span>XPATH, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;//*[contains(text(), &#39;</span><span style="color:#e6db74">{</span>text<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;)]&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> nth_result <span style="color:#f92672">&gt;</span> len(elements):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Match n°</span><span style="color:#e6db74">{</span>nth_result<span style="color:#e6db74">}</span><span style="color:#e6db74"> not found (only </span><span style="color:#e6db74">{</span>len(elements)<span style="color:#e6db74">}</span><span style="color:#e6db74"> matches found)&#34;</span>)
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found </span><span style="color:#e6db74">{</span>len(elements)<span style="color:#e6db74">}</span><span style="color:#e6db74"> matches for &#39;</span><span style="color:#e6db74">{</span>text<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;.&#34;</span>
</span></span><span style="display:flex;"><span>    elem <span style="color:#f92672">=</span> elements[nth_result <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    driver<span style="color:#f92672">.</span>execute_script(<span style="color:#e6db74">&#34;arguments[0].scrollIntoView(true);&#34;</span>, elem)
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">+=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Focused on element </span><span style="color:#e6db74">{</span>nth_result<span style="color:#e6db74">}</span><span style="color:#e6db74"> of </span><span style="color:#e6db74">{</span>len(elements)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@tool</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">go_back</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Goes back to previous page.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    driver<span style="color:#f92672">.</span>back()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@tool</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">close_popups</span>() <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Closes any visible modal or pop-up on the page. Use this to dismiss pop-up windows! 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This does not work on cookie consent banners.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    webdriver<span style="color:#f92672">.</span>ActionChains(driver)<span style="color:#f92672">.</span>send_keys(Keys<span style="color:#f92672">.</span>ESCAPE)<span style="color:#f92672">.</span>perform()
</span></span></code></pre></div><p>我们还需要<strong>保存屏幕截图的功能(Tool)</strong>，因为这将是我们 VLM 代理完成任务的关键部分。此功能捕获屏幕截图并将其保存到 <code>step_log.observations_images = [image.copy()]</code> 中，允许代理在导航过程中动态存储和处理图像。 ***</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save_screenshot</span>(step_log: ActionStep, agent: CodeAgent) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    sleep(<span style="color:#ae81ff">1.0</span>)  <span style="color:#75715e"># Let JavaScript animations happen before taking the screenshot</span>
</span></span><span style="display:flex;"><span>    driver <span style="color:#f92672">=</span> helium<span style="color:#f92672">.</span>get_driver()
</span></span><span style="display:flex;"><span>    current_step <span style="color:#f92672">=</span> step_log<span style="color:#f92672">.</span>step_number
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> driver <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> step_logs <span style="color:#f92672">in</span> agent<span style="color:#f92672">.</span>logs:  <span style="color:#75715e"># Remove previous screenshots from logs for lean processing</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(step_log, ActionStep) <span style="color:#f92672">and</span> step_log<span style="color:#f92672">.</span>step_number <span style="color:#f92672">&lt;=</span> current_step <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>                step_logs<span style="color:#f92672">.</span>observations_images <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        png_bytes <span style="color:#f92672">=</span> driver<span style="color:#f92672">.</span>get_screenshot_as_png()
</span></span><span style="display:flex;"><span>        image <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>open(BytesIO(png_bytes))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Captured a browser screenshot: </span><span style="color:#e6db74">{</span>image<span style="color:#f92672">.</span>size<span style="color:#e6db74">}</span><span style="color:#e6db74"> pixels&#34;</span>)
</span></span><span style="display:flex;"><span>        step_log<span style="color:#f92672">.</span>observations_images <span style="color:#f92672">=</span> [image<span style="color:#f92672">.</span>copy()]  <span style="color:#75715e"># Create a copy to ensure it persists, important!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Update observations with current URL</span>
</span></span><span style="display:flex;"><span>    url_info <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Current url: </span><span style="color:#e6db74">{</span>driver<span style="color:#f92672">.</span>current_url<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    step_log<span style="color:#f92672">.</span>observations <span style="color:#f92672">=</span> url_info <span style="color:#66d9ef">if</span> step_logs<span style="color:#f92672">.</span>observations <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> 
</span></span><span style="display:flex;"><span>                                     <span style="color:#66d9ef">else</span> step_log<span style="color:#f92672">.</span>observations <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> url_info
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span></code></pre></div><p>上面的该功能作为 <code>step_callback</code> 传递给代理【不是一个tool】，因为它在代理执行过程中的每个步骤结束时触发。这允许代理在其过程中动态捕获和保存屏幕截图：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> smolagents <span style="color:#f92672">import</span> CodeAgent, OpenAIServerModel, DuckDuckGoSearchTool
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> OpenAIServerModel(model_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gpt-4o&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>agent <span style="color:#f92672">=</span> CodeAgent(
</span></span><span style="display:flex;"><span>    tools<span style="color:#f92672">=</span>[DuckDuckGoSearchTool(), go_back, close_popups, search_item_ctrl_f],
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span>model,
</span></span><span style="display:flex;"><span>    additional_authorized_imports<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;helium&#34;</span>],
</span></span><span style="display:flex;"><span>    step_callbacks<span style="color:#f92672">=</span>[save_screenshot],  <span style="color:#75715e"># 在这里</span>
</span></span><span style="display:flex;"><span>    max_steps<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>,
</span></span><span style="display:flex;"><span>    verbosity_level<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>如此，在用户就可以提需求了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>agent<span style="color:#f92672">.</span>run(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Please search for images of Wonder Woman and generate a detailed visual description based on those images. Additionally, navigate to Wikipedia to gather key details about her appearance. With this information, I can determine whether to grant her access to the event.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span> <span style="color:#f92672">+</span> helium_instructions)
</span></span></code></pre></div><p><a href="https://youtu.be/rObJel7-OLc">YouTube 流程</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ashburnLee.github.io/blog-2-hugo/tags/agent/">Agent</a></li>
      <li><a href="https://ashburnLee.github.io/blog-2-hugo/tags/vlm/">VLM</a></li>
      <li><a href="https://ashburnLee.github.io/blog-2-hugo/tags/smolagents/">Smolagents</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://ashburnLee.github.io/blog-2-hugo/">Junhui&#39;s Journal 2</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
