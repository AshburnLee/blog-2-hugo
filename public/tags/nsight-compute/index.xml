<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Nsight Compute on Junhui&#39;s Journal 2</title>
    <link>https://ashburnLee.github.io/blog-2-hugo/tags/nsight-compute/</link>
    <description>Recent content in Nsight Compute on Junhui&#39;s Journal 2</description>
    <generator>Hugo -- 0.149.0</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 31 Aug 2025 12:47:01 +0800</lastBuildDate>
    <atom:link href="https://ashburnLee.github.io/blog-2-hugo/tags/nsight-compute/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Jetson Ncu 解读</title>
      <link>https://ashburnLee.github.io/blog-2-hugo/jetson/jetson-ncu-%E8%A7%A3%E8%AF%BB/</link>
      <pubDate>Sun, 31 Aug 2025 12:47:01 +0800</pubDate>
      <guid>https://ashburnLee.github.io/blog-2-hugo/jetson/jetson-ncu-%E8%A7%A3%E8%AF%BB/</guid>
      <description>&lt;h2 id=&#34;常用命令&#34;&gt;常用命令&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;launch-and-attach：启动程序并附加分析。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--kernel &amp;lt;kernel_name&amp;gt;：指定要分析的 CUDA 内核（可选，正则表达式匹配）。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--set &amp;lt;set_name&amp;gt;：指定指标集（例如，full、detailed 或自定义集）。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - full: 收集所有可用指标，适合全面分析，但耗时较长。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - detailed: 收集详细指标，覆盖计算、内存、调度等，适合深入优化。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - speed-of-light: 聚焦高层次吞吐量指标（如你的 Speed Of Light Throughput 报告）。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - occupancy: 聚焦占用率指标（如你的 Occupancy 报告）。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - scheduler: 分析线程束调度状态。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - memory: 分析内存访问和缓存性能。
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--metric dram__cycles_active.avg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;which ncu&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; --query-metrics  &lt;span style=&#34;color:#75715e&#34;&gt;# 输出所有支持的指标和描述&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;which ncu&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; --mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;launch-and-attach --kernel-name ComputeLogSoftmaxForwardInWarp --metric sm__warps_launched ./obj/softmax
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;rm -f ./ncu/softmax-last.ncu-rep &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;which ncu&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; --mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;launch-and-attach  -o ./ncu/softmax-last.ncu-rep ./obj/softmax &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;which ncu&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; --import ./ncu/softmax-last.ncu-rep &amp;gt; ./ncu/softmax-last.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ncu--o-softmax-lastncu-rep-softmax&#34;&gt;ncu -o ./softmax-last.ncu-rep ./softmax&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  void ComputeLogSoftmaxForwardInWarp&amp;lt;float, float, 4&amp;gt;&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;T1 *, const T1 *, int, int&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;1024, 1, 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;x&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;4, 32, 1&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, Context 1, Stream 7, Device 0, CC 8.7
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Section: GPU Speed Of Light Throughput
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ----------------------- ----------- ------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Metric Name             Metric Unit Metric Value
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ----------------------- ----------- ------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    SM Frequency                    Mhz       305.41  &lt;span style=&#34;color:#75715e&#34;&gt;# SM的运行频率：表示处于低功耗模式或未满载运行，由于散热或功耗限制）导致频率降低，&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Elapsed Cycles                cycle       32,515  &lt;span style=&#34;color:#75715e&#34;&gt;# kernel 执行的总时钟周期数：越小越好，如果过高，优化 kernel 以减少指令数或提高并行性。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Memory Throughput                 %        27.33  &lt;span style=&#34;color:#75715e&#34;&gt;# 内存带宽利用率：内存访问的效率 / 硬件峰值。27.33% 远低于 60% 的推荐阈值，表明内存带宽利用率非常低。检查内存访问模式（使用 NCU 的内存统计部分，查看 Global Memory 访问的合并程度）。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Duration                         us       106.46  &lt;span style=&#34;color:#75715e&#34;&gt;# kernel 执行的总时间（微秒）： 32,515 cycles ÷ 305.41 MHz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    L1/TEX Cache Throughput           %        29.40  &lt;span style=&#34;color:#75715e&#34;&gt;# L1 缓存和纹理缓存的带宽利用率：低于 60%，即缓存利用率低。数据访问模式不佳，未充分利用 L1 缓存。缓存命中率低（需要检查 NCU 的缓存命中率统计）。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    L2 Cache Throughput               %        22.36  &lt;span style=&#34;color:#75715e&#34;&gt;# 远低于预期，表明 L2 缓存未被有效利用。检查 L2 缓存的命中率（NCU 的缓存统计部分）。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    SM Active Cycles              cycle    28,654.75  &lt;span style=&#34;color:#75715e&#34;&gt;# SM 在执行计算任务时的活跃周期数：活跃周期占总周期的比例为 28,654.75 ÷ 32,515 ≈ 88.1% 挺好，但是。查看 NCU 的 Scheduler Statistics，检查线程束调度效率。否存在指令依赖或分支发散。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Compute &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;SM&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt; Throughput           %        57.48  &lt;span style=&#34;color:#75715e&#34;&gt;# SM 的计算吞吐量：57.48% 低于 60%，计算资源未被充分利用。可能线程块（Block）或网格（Grid）配置不足，导致 SM 未满载。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ----------------------- ----------- ------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;## 优化建议：低计算吞吐量 (57.48%) 和低内存带宽利用率 (27.33%): 表明内核未充分利用 GPU 的计算和内存资源。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;## 延迟问题 (Latency Issues): 低吞吐量通常由以下原因导致。内存访问延迟（例如，非合并内存访问或缓存未命中）。&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;## 建议分析方向：&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    OPT   This kernel exhibits low compute throughput and memory bandwidth utilization relative to the peak performance 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          of this device. Achieved compute throughput and/or memory bandwidth below 60.0% of peak typically indicate    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          latency issues. Look at Scheduler Statistics and Warp State Statistics &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; potential reasons.                 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;## fp32 的峰值性能是fp64的64倍，但是fp32 的吞吐只有16%，说明内核并未充分利用GPU的计算资源。与上述SM 吞吐 只有57.48% 一致 **&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    Section: GPU Speed Of Light Roofline Chart
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    INF The ratio of peak float fp32 to double fp64 performance on this device is 64:1. 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          The kernel achieved 16% of this device&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;#39;&lt;/span&gt;s fp32 peak performance and 0% of its fp64 peak performance. 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;结论：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
