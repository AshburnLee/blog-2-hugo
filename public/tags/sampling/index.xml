<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Sampling on Junhui&#39;s Journal 2</title>
    <link>https://ashburnLee.github.io/blog-2-hugo/tags/sampling/</link>
    <description>Recent content in Sampling on Junhui&#39;s Journal 2</description>
    <generator>Hugo -- 0.149.0</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 31 Aug 2025 12:49:41 +0800</lastBuildDate>
    <atom:link href="https://ashburnLee.github.io/blog-2-hugo/tags/sampling/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>5.9 Topk Topp Temperature</title>
      <link>https://ashburnLee.github.io/blog-2-hugo/llm/5.9.topk-topp-temperature/</link>
      <pubDate>Sun, 31 Aug 2025 12:49:41 +0800</pubDate>
      <guid>https://ashburnLee.github.io/blog-2-hugo/llm/5.9.topk-topp-temperature/</guid>
      <description>&lt;h2 id=&#34;top-k-采样&#34;&gt;Top-K 采样&lt;/h2&gt;
&lt;p&gt;定义：从模型输出的概率分布中选择概率&lt;strong&gt;最高的 $ K $ 个 token 作为候选集&lt;/strong&gt;，其余 token 概率置零，再归一化后采样。&lt;/p&gt;
&lt;p&gt;数学定义：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;给定 logits $ z_i $（模型输出），经 softmax 得概率：
$$p_i = \frac{\exp(z_i)}{\sum_j \exp(z_j)}$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;选择 $ p_i $ 最大的 $ K $ 个 token，重新归一化：
$$p_i&amp;rsquo; = \frac{p_i}{\sum_{j \in \text{top-K}} p_j}, \quad p_i = 0 \text{ if } i \notin \text{top-K}$$&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;作用：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;限制词汇量，减少低概率、无意义 token（如拼写错误）。&lt;/li&gt;
&lt;li&gt;提高连贯性，降低创造性。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;llama.cpp&lt;/code&gt; 中实现：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;llama_sampler_top_k_impl&lt;/span&gt;(llama_token_data_array &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; cur_p, &lt;span style=&#34;color:#66d9ef&#34;&gt;int32_t&lt;/span&gt; k) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (k &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt;;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    k &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; std&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;min(k, (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) cur_p&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;size);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 降序排序
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    bucket_sort(cur_p&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;data);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    cur_p&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;size &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; k;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;top-p-采样&#34;&gt;Top-P 采样&lt;/h2&gt;
&lt;p&gt;定义：选择累积概率达到 $ p $ 的&lt;strong&gt;最小 token 集&lt;/strong&gt;，过滤低于阈值的 token，再归一化后采样。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
